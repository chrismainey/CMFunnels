<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Funnel Plots for Indirectly-Standardised Ratios — funnel_plot • FunnelPlotR</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />
<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Funnel Plots for Indirectly-Standardised Ratios — funnel_plot" />

<meta property="og:description" content="This is an implementation of funnel plots described Spiegelhalter (2005).
There are several parameters for the input, with the assumption that you will want smooth,
 overdispersed, funnel limits plotted based on the DerSimmonian Laird \(\tau^2\) additive random
effects models." />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FunnelPlotR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/funnel_plots.html">Funnel Plots for Indirectly-standardised ratios</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Funnel Plots for Indirectly-Standardised Ratios</h1>
    
    <div class="hidden name"><code>funnel_plot.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This is an implementation of funnel plots described Spiegelhalter (2005).
There are several parameters for the input, with the assumption that you will want smooth,
 overdispersed, funnel limits plotted based on the DerSimmonian Laird \(\tau^2\) additive random
effects models.</p>
    
    </div>

    <pre class="usage"><span class='fu'>funnel_plot</span>(<span class='no'>numerator</span>, <span class='no'>denominator</span>, <span class='no'>group</span>, <span class='kw'>aggregate_input_data</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>label_outliers</span> <span class='kw'>=</span> <span class='fl'>99</span>, <span class='kw'>Poisson_limits</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>OD_adjust</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"SHMI"</span>, <span class='kw'>Winsorise_by</span> <span class='kw'>=</span> <span class='fl'>0.1</span>,
  <span class='kw'>title</span> <span class='kw'>=</span> <span class='st'>"Untitled Funnel Plot"</span>, <span class='kw'>multiplier</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>x_label</span> <span class='kw'>=</span> <span class='st'>"Expected"</span>, <span class='kw'>y_label</span> <span class='kw'>=</span> <span class='st'>"Standardised Ratio"</span>, <span class='no'>yrange</span>, <span class='no'>xrange</span>,
  <span class='kw'>return_elements</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"plot"</span>, <span class='st'>"data"</span>, <span class='st'>"limits"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>numerator</th>
      <td><p>A vector of the numerator (observed events/counts) values.  Used as numerator of the Y-axis</p></td>
    </tr>
    <tr>
      <th>denominator</th>
      <td><p>A vector of denominator (predicted/population etc).  Used as denominator of the Y-axis and the scale of the x-axis</p></td>
    </tr>
    <tr>
      <th>group</th>
      <td><p>A vector of group names or a factor.  Used to aggreagate and group points on plots</p></td>
    </tr>
    <tr>
      <th>aggregate_input_data</th>
      <td><p>Should the function aggreagate the inputs, by group, before passing into OD adjustment and plot? Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>label_outliers</th>
      <td><p>Add group labels to outliers on plot. Accepted values are: 95 or 99 corresponding to 95% or 99.8% quantiles of the distribution. Default=99</p></td>
    </tr>
    <tr>
      <th>Poisson_limits</th>
      <td><p>Draw exact limits based only on data points with no iterpolation. (default=FALSE)</p></td>
    </tr>
    <tr>
      <th>OD_adjust</th>
      <td><p>Draw overdispersed limits using Speigelhalter's (2012) Tau2 (default=TRUE)</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Either "CQC" or "SHMI" (default). There are a few methods for standardisation.  CQC/Spiegelhalter
uses a square-root transformation and Winsorises by replacing values, SHMI uses log-transformation and doesn't Winsorise as such, but
truncates the distribution instead.  Both methods as used before calcuating the dispersion ratio (phi), and plot is drawn for the full dataset, not the
Winsorised/truncated one. SHMI method is default.</p></td>
    </tr>
    <tr>
      <th>Winsorise_by</th>
      <td><p>Proportion of the distribution for winsorization. Default is 10 % (0.1)</p></td>
    </tr>
    <tr>
      <th>title</th>
      <td><p>Plot title</p></td>
    </tr>
    <tr>
      <th>multiplier</th>
      <td><p>Scale relative risk and funnel by this factor. Default to 1, but 100 is used for HSMR</p></td>
    </tr>
    <tr>
      <th>x_label</th>
      <td><p>Title for the funnel plot x-axis.  Usually expected deaths, readmissions, incidents etc.</p></td>
    </tr>
    <tr>
      <th>y_label</th>
      <td><p>Title for the funnel plot y-axis.  Usually a standardised ratio.</p></td>
    </tr>
    <tr>
      <th>yrange</th>
      <td><p>Manually specify the y-axis min and max, in form c(min, max), e.g. c(0.7, 1.3). Default, NULL, allows function to estimate range.</p></td>
    </tr>
    <tr>
      <th>xrange</th>
      <td><p>Manually specify the y-axis min and max, in form c(min, max), e.g. c(0, 200). Default, NULL, allows function to estimate range.</p></td>
    </tr>
    <tr>
      <th>return_elements</th>
      <td><p>a vector of elements ot return, options include "plot" for ggplot2 object, "data" for data after processing, and "limits" for control limit lookup table used in the plot. Default is all three objects</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list containing [1]the base table for the plot, [2]the limits table and [3]the funnel plot as a ggplot2 object.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Outliers are marked based on the grouping, controlled by `label_outliers` .
   Overdispersion can be factored in based on the methods in <a href='https://rss.onlinelibrary.wiley.com/doi/full/10.1111/j.1467-985X.2011.01010.x'>Spiegelhalter et al (2012)</a>, set `OD_Tau2` to FALSE to suppress this.
   To use Poisson limits set `Poisson_limits=TRUE`. This uses 2 &amp; 3 \(\sigma\) limits.
   It deliberatley avoids red-amber-green colouring, but you could extract this from the ggplot object and change manually if you like.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='https://rss.onlinelibrary.wiley.com/doi/full/10.1111/j.1467-985X.2011.01010.x'>Statistical methods for healthcare regulation: rating, screening and surveillance. Spiegelhalter et al (2012)</a>
   <a href='https://onlinelibrary.wiley.com/doi/10.1002/sim.1970'>Funnel plots for comparing institutional performance. Spiegelhalter (2004)</a>
   <a href='https://qualitysafety.bmj.com/content/14/5/347'>Handeling over-dispersion of performance indicators. Spiegelhalter (2005)</a></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># lets use the \'medpar\' dataset from the \'COUNT\' package.</span>
<span class='co'># Little reformatting needed</span>

<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>COUNT</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/data'>data</a></span>(<span class='no'>medpar</span>)
<span class='no'>medpar</span>$<span class='no'>provnum</span><span class='kw'>&lt;-</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/factor'>factor</a></span>(<span class='no'>medpar</span>$<span class='no'>provnum</span>)
<span class='no'>medpar</span>$<span class='no'>los</span><span class='kw'>&lt;-</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/numeric'>as.numeric</a></span>(<span class='no'>medpar</span>$<span class='no'>los</span>)

<span class='no'>mod</span><span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/glm'>glm</a></span>(<span class='no'>los</span> ~ <span class='no'>hmo</span> + <span class='no'>died</span> + <span class='no'>age80</span> + <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/factor'>factor</a></span>(<span class='no'>type</span>)
      , <span class='kw'>family</span><span class='kw'>=</span><span class='st'>"poisson"</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>medpar</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/summary'>summary</a></span>(<span class='no'>mod</span>)

<span class='co'># Get predicted value for ratio</span>
<span class='no'>medpar</span>$<span class='no'>prds</span><span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/predict'>predict</a></span>(<span class='no'>mod</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"response"</span>)

<span class='co'># Draw plot, returning just the plot object</span>
<span class='no'>fp</span><span class='kw'>&lt;-</span><span class='fu'>funnel_plot_dev</span>(<span class='kw'>denominator</span><span class='kw'>=</span><span class='no'>medpar</span>$<span class='no'>prds</span>,<span class='kw'>numerator</span><span class='kw'>=</span><span class='no'>medpar</span>$<span class='no'>los</span>,
<span class='kw'>group</span> <span class='kw'>=</span> <span class='no'>medpar</span>$<span class='no'>provnum</span>, <span class='kw'>return_elements</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"plot"</span>))
<span class='no'>fp</span>
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Chris Mainey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

